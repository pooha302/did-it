import 'package:flutter/material.dart';
import 'package:shared_preferences/shared_preferences.dart';
import 'dart:ui' as ui;
import '../services/analytics_service.dart';

class AppLocaleProvider with ChangeNotifier {
  Locale? _locale; // Current locale
  
  Locale? get locale => _locale;

  AppLocaleProvider() {
    _loadLocale();
  }

  void setLocale(Locale? locale) async {
    _locale = locale;
    notifyListeners();
    
    final prefs = await SharedPreferences.getInstance();
    if (locale == null) {
      await prefs.remove('language_code');
    } else {
      await prefs.setString('language_code', locale.languageCode);
    }
    
    // Log GA Event
    AnalyticsService.instance.logLanguageChange(locale?.languageCode ?? 'system');
  }

  Future<void> _loadLocale() async {
    final prefs = await SharedPreferences.getInstance();
    final languageCode = prefs.getString('language_code');
    if (languageCode != null) {
      _locale = Locale(languageCode);
    } else {
      _locale = null; // Follow system
    }
    notifyListeners();
  }

  void resetToDefaults() {
    _locale = null; // Follow system
    notifyListeners();
    AnalyticsService.instance.logLanguageChange('system');
  }

  static Map<String, Map<String, String>> translations = {
    'ko': {
      'settings': 'ì„¤ì •',
      'language': 'ì–¸ì–´',
      'follow_system': 'ì‹œìŠ¤í…œ ê¸°ë³¸ê°’',
      'reset': 'ì´ˆê¸°í™”',
      // Action Types
      'action_coffee': 'ì»¤í”¼',
      'action_water': 'ë¬¼ ë§ˆì‹œê¸°',
      'action_pill': 'ì•½',
      'action_exercise': 'ìš´ë™',
      'action_snack': 'êµ°ê²ƒì§ˆ',
      'cloud_backup': 'ë°±ì—… ë° ë³µì›',
      'backup': 'ë°ì´í„° ë°±ì—…',
      'restore': 'ë°ì´í„° ë³µì›',
      'backup_success': 'ë°ì´í„° ë°±ì—… ì™„ë£Œ!',
      'restore_success': 'ë°ì´í„° ë³µì› ì™„ë£Œ!',
      'backup_desc': 'ì†Œì¤‘í•œ ë‚´ ìë£Œ, í´ë¼ìš°ë“œì— ì•ˆì „í•˜ê²Œ ë§¡ê²¨ë‘˜ê¹Œìš”? â˜ï¸',
      'restore_desc': 'í´ë¼ìš°ë“œì— ë³´ê´€í•´ë‘” ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì˜¬ê¹Œìš”? (ì§€ê¸ˆ ìë£ŒëŠ” ì‚¬ë¼ì ¸ìš”!) ğŸ“¥',
      'days': 'ì¼',
      'goal_label': 'ëª©í‘œ',
      'reset_confirm': 'ì–´ë¨¸, ì‹¤ìˆ˜ì˜€ë‚˜ìš”? ìŠ¥ì‚­ ì§€ì›Œë“œë¦´ê¹Œìš”? ğŸ§¹',
      'cancel': 'ì·¨ì†Œ',
      'no_data': 'ê¸°ë¡ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤',
      'tap_to_record': 'ì½•! ëˆŒëŸ¬ì„œ ê¸°ë¡í•´ ë³´ì„¸ìš”',
      'goal_reached': 'í•´ëƒˆë‹¹!',
      'limit_reached': 'ì—¬ê¸°ê¹Œì§€! âœ‹',
      'limit_exceeded': 'ì„  ë„˜ìŒ! ğŸ˜±',
      'min': 'ìµœì†Œ',
      'max': 'ìµœëŒ€',
      'avg': 'í‰ê· ',
      'replenish_resets': 'ê´‘ê³  ì‹œì²­',
      'resets_exhausted_msg': 'ì´ˆê¸°í™”ê°€ ë°”ë‹¥ë‚¬ì–´ìš”! ê´‘ê³  ë³´ê³  3ë²ˆì˜ ê¸°íšŒë¥¼ ë” ë“œë¦´ê¹Œìš”? ğŸ',
      'active_action_none': 'í…… ë¹„ì–´ ìˆë„¤ìš”! ë‹¹ì‹ ì˜ í•˜ë£¨ë¥¼ ë©‹ì§„ í–‰ë™ìœ¼ë¡œ ì±„ì›Œë³´ì„¸ìš” ğŸ“',
      'nothing_to_reset': 'ì§€ìš¸ ê²Œ ì—†ì–´ìš”! ì•„ì§ í•œ ë²ˆë„ ì•ˆ ëˆ„ë¥´ì…¨ë‚˜ ë´ìš”? ğŸ¤·â€â™‚ï¸',
      'delete_action_confirm': 'ì •ë§ë¡œ ì´ í–‰ë™ê³¼ ì‘ë³„í•˜ì‹¤ ê±´ê°€ìš”? ê¸°ë¡ì´ ë‹¤ ì‚¬ë¼ì ¸ìš”! ğŸ˜¢',
      'create': 'ì¶”ê°€',
      'add_action_btn': 'ì¶”ê°€',
      'delete': 'ì‚­ì œ',
      'tutorial_reset_title': 'ì´ˆê¸°í™”',
      'tutorial_reset_desc': '"ì•—, ì†ê°€ë½ì´ ë¯¸ë„ëŸ¬ì¡Œë„¤!" ì‹¶ì„ ë• ì£¼ì € ë§ê³  ì—¬ê¸°ë¥¼! (í•˜ë£¨ì— í•œ ë²ˆì€ ë¬´ë£Œë¡œ ë˜ëŒë ¤ ë“œë ¤ìš”! ğŸ)',
      'tutorial_action_title': 'í–‰ë™ ëª©ë¡',
      'tutorial_action_desc': 'í–‰ë™ì„ ê´€ë¦¬í•˜ëŠ” ê³³ì´ì—ìš”. ì¤€ë¹„ë˜ì…¨ë‚˜ìš”? âœ¨',
      'tutorial_record_title': 'í–‰ë™ ê¸°ë¡',
      'tutorial_record_desc': 'ê¸°ë¡ì€ ê°€ë³ê²Œ í†¡! ì˜†ìœ¼ë¡œ ìŠ¥~ ë„˜ê²¨ì„œ ë‹¤ë¥¸ í–‰ë™ë“¤ë„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”! ğŸ‘†',
      'tutorial_help_title': 'ë„ì›€ë§',
      'tutorial_help_desc': 'ë‹¹í™©í•˜ì§€ ë§ˆì„¸ìš”! ì–¸ì œë“  ì œê°€ ë‹¤ì‹œ ì„¤ëª…í•´ ë“œë¦´ê²Œìš”. ğŸ’¡',
      'tutorial_goal_input_title': 'ëª©í‘œ ì„¤ì •',
      'tutorial_goal_input_desc': 'ëª©í‘œì¹˜ë¥¼ ì ì–´ë‘ë©´ ì§„í–‰ ìƒí™©ì„ í™•ì¸í•˜ê¸° ì •ë§ í¸í•´ìš”! 0ì„ ì ìœ¼ë©´ ëª©í‘œ ì—†ì´ ê¸°ë¡ë§Œ í•  ìˆ˜ë„ ìˆë‹µë‹ˆë‹¤. ğŸ¯',
      'tutorial_goal_type_title': 'í–‰ë™ ìœ í˜•',
      'tutorial_goal_type_desc': 'ë‚˜ì—ê²Œ ê¸ì •ì ì¸ê°€ìš”? ë¶€ì •ì ì¸ê°€ìš”? ì„±ê²©ì— ë§ì¶° ì™ ê³¨ë¼ë³´ì„¸ìš”! ğŸ‘ğŸ‘',
      'tutorial_goal_active_title': 'í–‰ë™ í™œì„±í™”',
      'tutorial_goal_active_desc': 'ìŠ¤ìœ„ì¹˜ë¥¼ ê»ë‹¤ ì¼°ë‹¤ í•˜ë©´ì„œ ë©”ì¸ í™”ë©´ì— ë³´ì—¬ì¤„ì§€ ë§ì§€ ë§˜ëŒ€ë¡œ ì •í•´ ë³´ì„¸ìš”! ğŸ”˜',
      'tutorial_goal_reorder_title': 'ìˆœì„œ ë³€ê²½',
      'tutorial_goal_reorder_desc': 'ê¾¹ ëˆŒëŸ¬ì„œ ìœ„ì•„ë˜ë¡œ! ë‹¹ì‹ ì—ê²Œ ì¤‘ìš”í•œ ìˆœì„œëŒ€ë¡œ ì¤„ ì„¸ì›Œë³´ì„¸ìš”. â†•ï¸',
      'tutorial_goal_delete_title': 'í–‰ë™ ì‚­ì œ',
      'tutorial_goal_delete_desc': 'ì•ˆë…•ì€ ì˜ì›í•œ í—¤ì–´ì§ì€ ì•„ë‹ˆê² ì§€ìš”... ì™¼ìª½ìœ¼ë¡œ ìŠ¥ ë°€ë©´ ì‚­ì œ! ğŸ—‘ï¸',
      'tutorial_goal_help_title': 'ë„ì›€ë§',
      'tutorial_goal_help_desc': 'ê¶ê¸ˆí•œ ê²Œ ìƒê¸°ë©´ ì–¸ì œë“  ì €ë¥¼ ë¶ˆëŸ¬ì£¼ì„¸ìš”. ì—¬ê¸° ëŒ€ê¸° ì¤‘! ğŸ™‹â€â™‚ï¸',
      'custom': 'ì§ì ‘ ì…ë ¥',
      'action_placeholder': 'ì˜¤ëŠ˜ì€ ë¬´ì—‡ì„ Did it í•´ë³¼ê¹Œìš”?',
      'confirm': 'í™•ì¸',
      'ok': 'í™•ì¸',
      'daily_reset_msg': 'ìƒˆë¡œìš´ í•˜ë£¨ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!\në°ì´í„°ë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤. â˜€ï¸',
    },
    'en': {
      'settings': 'Settings',
      'language': 'Language',
      'follow_system': 'System Default',
      'reset': 'Reset',
      // Action Types
      'action_coffee': 'Coffee',
      'action_water': 'Drink Water',
      'action_pill': 'Medicine',
      'action_exercise': 'Exercise',
      'action_snack': 'Snacks',
      'cloud_backup': 'Backup & Restore',
      'backup': 'Data Backup',
      'restore': 'Data Restore',
      'backup_success': 'Data Backup Complete!',
      'restore_success': 'Data Restore Complete!',
      'backup_desc': 'Shall we keep your precious data safe in the cloud? â˜ï¸',
      'restore_desc': 'Would you like to bring back the data stored in the cloud? (Current data will be lost!) ğŸ“¥',
      'days': 'Day',
      'goal_label': 'Goal',
      'reset_confirm': 'Oh, was it a mistake? Shall I wipe it clean? ğŸ§¹',
      'cancel': 'Cancel',
      'no_data': 'No data recorded',
      'tap_to_record': 'Tap! to record',
      'goal_reached': 'Did it!',
      'limit_reached': 'Enough! âœ‹',
      'limit_exceeded': 'Over the limit! ğŸ«¢',
      'min': 'Min',
      'max': 'Max',
      'avg': 'Avg',
      'replenish_resets': 'Watch Ad',
      'resets_exhausted_msg': 'Ran out of resets! Shall I give you 3 more chances after watching an ad? ğŸ',
      'active_action_none': 'It\'s empty! Fill your day with wonderful actions ğŸ“',
      'nothing_to_reset': 'Nothing to clear! Haven\'t you tapped yet? ğŸ¤·â€â™‚ï¸',
      'delete_action_confirm': 'Are you really going to say goodbye to this action? All records will be gone! ğŸ˜¢',
      'create': 'Add',
      'add_action_btn': 'Add',
      'delete': 'Delete',
      'tutorial_reset_title': 'Reset',
      'tutorial_reset_desc': '"Oops, my finger slipped!" Tap here! (First reset of the day is free! ğŸ)',
      'tutorial_action_title': 'Action List',
      'tutorial_action_desc': 'This is where you manage your actions. Ready? âœ¨',
      'tutorial_record_title': 'Record Action',
      'tutorial_record_desc': 'Tap lightly to record! Swipe sideways to check other actions! ğŸ‘†',
      'tutorial_help_title': 'Help',
      'tutorial_help_desc': 'Don\'t panic! I\'ll explain it again anytime. ğŸ’¡',
      'tutorial_goal_input_title': 'Set Goal',
      'tutorial_goal_input_desc': 'Writing down a goal makes it really easy to track progress! Write 0 to just record without a goal. ğŸ¯',
      'tutorial_goal_type_title': 'Action Type',
      'tutorial_goal_type_desc': 'Is this positive for you or negative? Pick the one that fits! ğŸ‘ğŸ‘',
      'tutorial_goal_active_title': 'Enable Action',
      'tutorial_goal_active_desc': 'Decide for yourself whether to show it on the main screen by toggling the switch! ğŸ”˜',
      'tutorial_goal_reorder_title': 'Reorder',
      'tutorial_goal_reorder_desc': 'Press and hold to move up and down! Line them up in the order that\'s important to you. â†•ï¸',
      'tutorial_goal_delete_title': 'Delete Action',
      'tutorial_goal_delete_desc': 'Goodbye isn\'t forever... Swipe left to delete! ğŸ—‘ï¸',
      'tutorial_goal_help_title': 'Help',
      'tutorial_goal_help_desc': 'If you have any questions, call me anytime. I\'m waiting here! ğŸ™‹â€â™‚ï¸',
      'custom': 'Direct Input',
      'action_placeholder': 'What shall we Did it today?',
      'confirm': 'Confirm',
      'ok': 'OK',
      'daily_reset_msg': 'A new day has started!\nRefreshing data. â˜€ï¸',
    },
    'ja': {
      'settings': 'è¨­å®š',
      'language': 'è¨€èª',
      'follow_system': 'ã‚·ã‚¹ãƒ†ãƒ è¨­å®š',
      'reset': 'åˆæœŸåŒ–',
      // Action Types
      'action_coffee': 'ã‚³ãƒ¼ãƒ’ãƒ¼',
      'action_water': 'æ°´ã‚’é£²ã‚€',
      'action_pill': 'è–¬',
      'action_exercise': 'é‹å‹•',
      'action_snack': 'ãŠã‚„ã¤',
      'cloud_backup': 'ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨å¾©å…ƒ',
      'backup': 'ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—',
      'restore': 'ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ',
      'backup_success': 'ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†ï¼',
      'restore_success': 'ãƒ‡ãƒ¼ã‚¿å¾©å…ƒå®Œäº†ï¼',
      'backup_desc': 'å¤§åˆ‡ãªãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒ©ã‚¦ãƒ‰ã«å®‰å…¨ã«ä¿å­˜ã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿ â˜ï¸',
      'restore_desc': 'ã‚¯ãƒ©ã‚¦ãƒ‰ã«ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã™ã‹ï¼Ÿï¼ˆç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯å‰Šé™¤ã•ã‚Œã¾ã™ï¼ï¼‰ ğŸ“¥',
      'days': 'æ—¥',
      'goal_label': 'ç›®æ¨™',
      'reset_confirm': 'ã‚ã‚‰ã€é–“é•ã„ã§ã—ãŸã‹ï¼Ÿ ãã‚Œã„ã«æ¶ˆã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿ ğŸ§¹',
      'cancel': 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
      'no_data': 'è¨˜éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“',
      'tap_to_record': 'ãƒãƒ³ï¼ã¨å©ã„ã¦è¨˜éŒ²ã—ã¾ã—ã‚‡ã†',
      'goal_reached': 'ã‚„ã£ãŸã­ï¼',
      'limit_reached': 'ã“ã“ã¾ã§ï¼ âœ‹',
      'limit_exceeded': 'ã‚„ã‚Šã™ãæ³¨æ„ï¼ ğŸ˜±',
      'min': 'æœ€å°',
      'max': 'æœ€å¤§',
      'avg': 'å¹³å‡',
      'replenish_resets': 'åºƒå‘Šè¦–è´',
      'resets_exhausted_msg': 'ãƒªã‚»ãƒƒãƒˆå›æ•°ãŒãªããªã‚Šã¾ã—ãŸï¼åºƒå‘Šã‚’è¦‹ã¦3å›åˆ†ãƒãƒ£ãƒ¼ã‚¸ã—ã¾ã™ã‹ï¼Ÿ ğŸ',
      'active_action_none': 'ç©ºã£ã½ã§ã™ã­ï¼ã‚ãªãŸã®1æ—¥ã‚’ç´ æ•µãªè¡Œå‹•ã§æº€ãŸã—ã¦ã¿ã¾ã—ã‚‡ã† ğŸ“',
      'nothing_to_reset': 'ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã‚‚ã®ãŒã‚ã‚Šã¾ã›ã‚“ï¼ã¾ã ä¸€åº¦ã‚‚å©ã„ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ ğŸ¤·â€â™‚ï¸',
      'delete_action_confirm': 'æœ¬å½“ã«ã“ã®è¡Œå‹•ã¨ãŠåˆ¥ã‚Œã—ã¾ã™ã‹ï¼Ÿã™ã¹ã¦ã®è¨˜éŒ²ãŒæ¶ˆãˆã¦ã—ã¾ã„ã¾ã™ï¼ ğŸ˜¢',
      'create': 'è¿½åŠ ',
      'add_action_btn': 'è¿½åŠ ',
      'delete': 'å‰Šé™¤',
      'tutorial_reset_title': 'ãƒªã‚»ãƒƒãƒˆ',
      'tutorial_reset_desc': 'ã€Œã‚ã€é–“é•ãˆãŸï¼ã€ã¨ã„ã†æ™‚ã¯ã€è¿·ã‚ãšã“ã“ã‚’ï¼ï¼ˆ1æ—¥1å›ã¯ç„¡æ–™ã§ã™ï¼ğŸï¼‰',
      'tutorial_action_title': 'è¡Œå‹•ãƒªã‚¹ãƒˆ',
      'tutorial_action_desc': 'ã“ã“ã§è¡Œå±¤ã‚’ç®¡ç†ã—ã¾ã™ã€‚æº–å‚™ã¯ã„ã„ã§ã™ã‹ï¼Ÿ âœ¨',
      'tutorial_record_title': 'è¡Œå‹•ã®è¨˜éŒ²',
      'tutorial_record_desc': 'è»½ãå©ã„ã¦è¨˜éŒ²ï¼æ¨ªã«ã‚¹ãƒ¯ã‚¤ãƒ—ã—ã¦ä»–ã®è¡Œå‹•ã‚‚ç¢ºèªã§ãã¾ã™ï¼ ğŸ‘†',
      'tutorial_help_title': 'ãƒ˜ãƒ«ãƒ—',
      'tutorial_help_desc': 'å›°ã£ãŸã¨ãã¯ã€ã„ã¤ã§ã‚‚ç§ãŒèª¬æ˜ã—ã¾ã™ã€‚ğŸ’¡',
      'tutorial_goal_input_title': 'ç›®æ¨™è¨­å®š',
      'tutorial_goal_input_desc': 'ç›®æ¨™ã‚’è¨­å®šã™ã‚‹ã¨é€²æ—ãŒåˆ†ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã™ï¼0ã«ã™ã‚‹ã¨ç›®æ¨™ãªã—ã§è¨˜éŒ²ã ã‘ã‚‚å¯èƒ½ã§ã™ã€‚ ğŸ¯',
      'tutorial_goal_type_title': 'è¡Œå‹•ã‚¿ã‚¤ãƒ—',
      'tutorial_goal_type_desc': 'ã‚ãªãŸã«ã¨ã£ã¦ãƒã‚¸ãƒ†ã‚£ãƒ–ã§ã™ã‹ã€ãã‚Œã¨ã‚‚ãƒã‚¬ãƒ†ã‚£ãƒ–ã§ã™ã‹ï¼Ÿæ€§æ ¼ã«åˆã‚ã›ã¦é¸ã‚“ã§ãã ã•ã„ï¼ ğŸ‘ğŸ‘',
      'tutorial_goal_active_title': 'è¡Œå‹•ã®æœ‰åŠ¹åŒ–',
      'tutorial_goal_active_desc': 'ã‚¹ã‚¤ãƒƒãƒã§ãƒ¡ã‚¤ãƒ³ç”»é¢ã«è¡¨ç¤ºã™ã‚‹ã‹ã©ã†ã‹è‡ªç”±ã«æ±ºã‚ã‚‰ã‚Œã¾ã™ï¼ ğŸ”˜',
      'tutorial_goal_reorder_title': 'é †åºã®å¤‰æ›´',
      'tutorial_goal_reorder_desc': 'é•·æŠ¼ã—ã—ã¦ä¸Šä¸‹ã«ï¼ã‚ãªãŸã«ã¨ã£ã¦å¤§åˆ‡ãªé †ã«ä¸¦ã¹æ›¿ãˆã¾ã—ã‚‡ã†ã€‚ â†•ï¸',
      'tutorial_goal_delete_title': 'è¡Œå‹•ã®å‰Šé™¤',
      'tutorial_goal_delete_desc': 'ã•ã‚ˆã†ãªã‚‰ã¯æ°¸é ã®åˆ¥ã‚Œã˜ã‚ƒã‚ã‚Šã¾ã›ã‚“â€¦å·¦ã«ã‚¹ãƒ¯ã‚¤ãƒ—ã—ã¦å‰Šé™¤ï¼ ğŸ—‘ï¸',
      'tutorial_goal_help_title': 'ãƒ˜ãƒ«ãƒ—',
      'tutorial_goal_help_desc': 'æ°—ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Œã°ã„ã¤ã§ã‚‚å‘¼ã‚“ã§ãã ã•ã„ã€‚ã“ã“ã§å¾…æ©Ÿä¸­ï¼ ğŸ™‹â€â™‚ï¸',
      'custom': 'ç›´æ¥å…¥åŠ›',
      'action_placeholder': 'ä»Šæ—¥ã¯ä½•ã‚’ Did it ã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿ',
      'confirm': 'ç¢ºèª',
      'ok': 'OK',
      'daily_reset_msg': 'æ–°ã—ã„ä¸€æ—¥ãŒå§‹ã¾ã‚Šã¾ã—ãŸï¼\nãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã™ã€‚ â˜€ï¸',
    },
    'zh': {
      'settings': 'è®¾ç½®',
      'language': 'è¯­è¨€',
      'follow_system': 'ç³»ç»Ÿé»˜è®¤',
      'reset': 'é‡ç½®',
      // Action Types
      'action_coffee': 'å’–å•¡',
      'action_water': 'å–æ°´',
      'action_pill': 'è¯ç‰©',
      'action_exercise': 'è¿åŠ¨',
      'action_snack': 'é›¶é£Ÿ',
      'cloud_backup': 'å¤‡ä»½ä¸æ¢å¤',
      'backup': 'æ•°æ®å¤‡ä»½',
      'restore': 'æ•°æ®æ¢å¤',
      'backup_success': 'æ•°æ®å¤‡ä»½å®Œæˆï¼',
      'restore_success': 'æ•°æ®æ¢å¤å®Œæˆï¼',
      'backup_desc': 'è¦å°†æ‚¨çš„çè´µèµ„æ–™å®‰å…¨åœ°å­˜æ”¾åœ¨äº‘ç«¯å—ï¼Ÿ â˜ï¸',
      'restore_desc': 'è¦æ¢å¤äº‘ç«¯å­˜å‚¨çš„æ•°æ®å—ï¼Ÿï¼ˆå½“å‰æ•°æ®å°†ä¼šæ¶ˆå¤±ï¼ï¼‰ ğŸ“¥',
      'days': 'å¤©',
      'goal_label': 'ç›®æ ‡',
      'reset_confirm': 'å“å‘€ï¼Œæ˜¯å¤±è¯¯å—ï¼Ÿéœ€è¦æˆ‘å¸®æ‚¨æ“¦æ‰å—ï¼Ÿ ğŸ§¹',
      'cancel': 'å–æ¶ˆ',
      'no_data': 'æ²¡æœ‰è®°å½•çš„æ•°æ®',
      'tap_to_record': 'ç‚¹ä¸€ä¸‹è®°å½•ï¼',
      'goal_reached': 'åšåˆ°äº†ï¼',
      'limit_reached': 'åˆ°æ­¤ä¸ºæ­¢ï¼ âœ‹',
      'limit_exceeded': 'å·²ç»è¿‡é‡ï¼ ğŸ˜±',
      'min': 'æœ€å°',
      'max': 'æœ€å¤§',
      'avg': 'å¹³å‡',
      'replenish_resets': 'è§‚çœ‹å¹¿å‘Š',
      'resets_exhausted_msg': 'é‡ç½®æ¬¡æ•°ç”¨å®Œå•¦ï¼è§‚çœ‹å¹¿å‘Šåå†ä¸ºæ‚¨æä¾›3æ¬¡æœºä¼šå¥½å—ï¼Ÿ ğŸ',
      'active_action_none': 'ç©ºç©ºå¦‚ä¹Ÿï¼ç”¨ç²¾å½©çš„è¡ŒåŠ¨å¡«æ»¡æ‚¨çš„ä¸€å¤©å§ ğŸ“',
      'nothing_to_reset': 'æ²¡æœ‰å¯æ¸…é™¤çš„å†…å®¹ï¼è¿˜æ²¡ç‚¹è¿‡å—ï¼Ÿ ğŸ¤·â€â™‚ï¸',
      'delete_action_confirm': 'çœŸçš„è¦å’Œè¿™ä¸ªè¡ŒåŠ¨å‘Šåˆ«å—ï¼Ÿè®°å½•éƒ½ä¼šæ¶ˆå¤±çš„ï¼ ğŸ˜¢',
      'create': 'å¢åŠ ',
      'add_action_btn': 'å¢åŠ ',
      'delete': 'åˆ é™¤',
      'tutorial_reset_title': 'é‡ç½®',
      'tutorial_reset_desc': 'â€œå“å‘€ï¼Œæ‰‹æ»‘äº†ï¼â€ ç‚¹å‡»è¿™é‡Œï¼ï¼ˆæ¯å¤©ç¬¬ä¸€æ¬¡æ˜¯å…è´¹çš„ï¼ğŸï¼‰',
      'tutorial_action_title': 'è¡ŒåŠ¨åˆ—è¡¨',
      'tutorial_action_desc': 'è¿™æ˜¯ç®¡ç†è¡ŒåŠ¨çš„åœ°æ–¹ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿ âœ¨',
      'tutorial_record_title': 'è®°å½•è¡ŒåŠ¨',
      'tutorial_record_desc': 'è½»ç‚¹è®°å½•ï¼å‘ä¾§é¢æ»‘åŠ¨å¯ä»¥æŸ¥çœ‹å…¶ä»–è¡ŒåŠ¨ï¼ ğŸ‘†',
      'tutorial_help_title': 'å¸®åŠ©',
      'tutorial_help_desc': 'åˆ«æ…Œï¼æˆ‘éšæ—¶å¯ä»¥å†ä¸ºæ‚¨è§£é‡Šä¸€éã€‚ ğŸ’¡',
      'tutorial_goal_input_title': 'è®¾å®šç›®æ ‡',
      'tutorial_goal_input_desc': 'å†™ä¸‹ç›®æ ‡ä¼šè®©è·Ÿè¸ªè¿›åº¦å˜å¾—éå¸¸æ–¹ä¾¿ï¼å†™0å¯ä»¥åªè®°å½•ä¸è®¾ç›®æ ‡ã€‚ ğŸ¯',
      'tutorial_goal_type_title': 'è¡ŒåŠ¨ç±»å‹',
      'tutorial_goal_type_desc': 'è¿™å¯¹æ‚¨æ˜¯ç§¯æçš„è¿˜æ˜¯æ¶ˆæçš„ï¼Ÿé€‰æ‹©é€‚åˆæ‚¨çš„é‚£ä¸€ä¸ªï¼ ğŸ‘ğŸ‘',
      'tutorial_goal_active_title': 'å¯ç”¨è¡ŒåŠ¨',
      'tutorial_goal_active_desc': 'é€šè¿‡å¼€å…³å†³å®šæ˜¯å¦åœ¨ä¸»å±å¹•æ˜¾ç¤ºï¼ ğŸ”˜',
      'tutorial_goal_reorder_title': 'è°ƒæ•´é¡ºåº',
      'tutorial_goal_reorder_desc': 'é•¿æŒ‰å¹¶ä¸Šä¸‹ç§»åŠ¨ï¼æŒ‰ç…§å¯¹æ‚¨é‡è¦çš„é¡ºåºæ’åˆ—å§ã€‚ â†•ï¸',
      'tutorial_goal_delete_title': 'åˆ é™¤è¡ŒåŠ¨',
      'tutorial_goal_delete_desc': 'å‘Šåˆ«ä¸æ˜¯æ°¸è¿œçš„... å‘å·¦æ»‘åŠ¨åˆ é™¤ï¼ ğŸ—‘ï¸',
      'tutorial_goal_help_title': 'å¸®åŠ©',
      'tutorial_goal_help_desc': 'å¦‚æœæœ‰ä»»ä½•ç–‘é—®ï¼Œéšæ—¶å«æˆ‘ã€‚æˆ‘åœ¨è¿™é‡Œç­‰å€™ï¼ ğŸ™‹â€â™‚ï¸',
      'custom': 'ç›´æ¥è¾“å…¥',
      'action_placeholder': 'ä»Šå¤©è¦åšç‚¹ä»€ä¹ˆ Did it å‘¢ï¼Ÿ',
      'confirm': 'ç¡®è®¤',
      'ok': 'ç¡®å®š',
    },
    'es': {
      'settings': 'Ajustes',
      'language': 'Idioma',
      'follow_system': 'Predeterminado',
      'reset': 'Reiniciar',
      // Action Types
      'action_coffee': 'CafÃ©',
      'action_water': 'Beber agua',
      'action_pill': 'Medicina',
      'action_exercise': 'Ejercicio',
      'action_snack': 'Meriendas',
      'cloud_backup': 'Copia y restauraciÃ³n',
      'backup': 'Copia de seguridad',
      'restore': 'RestauraciÃ³n',
      'backup_success': 'Â¡Copia de seguridad completada!',
      'restore_success': 'Â¡RestauraciÃ³n completada!',
      'backup_desc': 'Â¿Guardamos tus valiosos datos de forma segura en la nube? â˜ï¸',
      'restore_desc': 'Â¿Quieres recuperar los datos guardados en la nube? (Â¡Se perderÃ¡n los datos actuales!) ğŸ“¥',
      'days': 'dÃ­as',
      'goal_label': 'Meta',
      'reset_confirm': 'Â¡Vaya! Â¿Fue un error? Â¿Lo borramos? ğŸ§¹',
      'cancel': 'Cancelar',
      'no_data': 'No hay datos registrados',
      'tap_to_record': 'Â¡Toca para registrar!',
      'goal_reached': 'Â¡Lo logrÃ©!',
      'limit_reached': 'Â¡Es suficiente! âœ‹',
      'limit_exceeded': 'Â¡Excedido! ğŸ˜±',
      'min': 'MÃ­n',
      'max': 'MÃ¡x',
      'avg': 'Prom',
      'replenish_resets': 'Ver anuncio',
      'resets_exhausted_msg': 'Â¡Se acabaron los reinicios! Â¿Quieres 3 oportunidades mÃ¡s tras ver un anuncio? ğŸ',
      'active_action_none': 'Â¡EstÃ¡ vacÃ­o! Llena tu dÃ­a con acciones maravillosas ğŸ“',
      'nothing_to_reset': 'Â¡Nada que borrar! Â¿AÃºn no has tocado? ğŸ¤·â€â™‚ï¸',
      'delete_action_confirm': 'Â¿De verdad vas a despedirte de esta acciÃ³n? Â¡Se perderÃ¡n todos los registros! ğŸ˜¢',
      'create': 'AÃ±adir',
      'add_action_btn': 'AÃ±adir',
      'delete': 'Eliminar',
      'tutorial_reset_title': 'Reiniciar',
      'tutorial_reset_desc': 'Â¡Uy, se me resbalÃ³ el dedo! Â¡Pulsa aquÃ­! (Â¡El primero del dÃ­a es gratis! ğŸ)',
      'tutorial_action_title': 'Lista de acciones',
      'tutorial_action_desc': 'AquÃ­ es donde gestionas tus acciones. Â¿Listo? âœ¨',
      'tutorial_record_title': 'Registrar acciÃ³n',
      'tutorial_record_desc': 'Â¡Toca suavemente para registrar! Â¡Desliza hacia los lados para ver otras acciones! ğŸ‘†',
      'tutorial_help_title': 'Ayuda',
      'tutorial_help_desc': 'Â¡No te asustes! Te lo explicarÃ© de nuevo en cualquier momento. ğŸ’¡',
      'tutorial_goal_input_title': 'Fijar meta',
      'tutorial_goal_input_desc': 'Â¡Anotar una meta facilita mucho el seguimiento! Pon 0 para solo registrar sin meta. ğŸ¯',
      'tutorial_goal_type_title': 'Tipo de acciÃ³n',
      'tutorial_goal_type_desc': 'Â¿Es esto positivo para ti o negativo? Â¡Elige lo que encaje! ğŸ‘ğŸ‘',
      'tutorial_goal_active_title': 'Activar acciÃ³n',
      'tutorial_goal_active_desc': 'Â¡Decide si quieres mostrarla en la pantalla principal activando el interruptor! ğŸ”˜',
      'tutorial_goal_reorder_title': 'Reordenar',
      'tutorial_goal_reorder_desc': 'Â¡MantÃ©n presionado para mover arriba y abajo! Ponlas en el orden que sea importante para ti. â†•ï¸',
      'tutorial_goal_delete_title': 'Eliminar acciÃ³n',
      'tutorial_goal_delete_desc': 'El adiÃ³s no es para siempre... Â¡Desliza a la izquierda para borrar! ğŸ—‘ï¸',
      'tutorial_goal_help_title': 'Ayuda',
      'tutorial_goal_help_desc': 'Si tienes dudas, llÃ¡mame cuando quieras. Â¡AquÃ­ te espero! ğŸ™‹â€â™‚ï¸',
      'custom': 'Entrada directa',
      'action_placeholder': 'Â¿QuÃ© vamos a Did it hoy?',
      'confirm': 'Confirmar',
      'ok': 'OK',
    },
    'fr': {
      'settings': 'ParamÃ¨tres',
      'language': 'Langue',
      'follow_system': 'Par dÃ©faut',
      'reset': 'RÃ©initialiser',
      // Action Types
      'action_coffee': 'CafÃ©',
      'action_water': 'Boire de l\'eau',
      'action_pill': 'MÃ©dicament',
      'action_exercise': 'Exercice',
      'action_snack': 'Snacks',
      'cloud_backup': 'Sauvegarde et restauration',
      'backup': 'Sauvegarde',
      'restore': 'Restauration',
      'backup_success': 'Sauvegarde terminÃ©e !',
      'restore_success': 'Restauration terminÃ©e !',
      'backup_desc': 'Voulez-vous sauvegarder vos prÃ©cieuses donnÃ©es dans le cloud ? â˜ï¸',
      'restore_desc': 'Voulez-vous rÃ©cupÃ©rer les donnÃ©es stockÃ©es dans le cloud ? (Les donnÃ©es actuelles seront perdues !) ğŸ“¥',
      'days': 'jours',
      'goal_label': 'Objectif',
      'reset_confirm': 'Mince ! C\'Ã©tait une erreur ? On l\'efface ? ğŸ§¹',
      'cancel': 'Annuler',
      'no_data': 'Aucune donnÃ©e enregistrÃ©e',
      'tap_to_record': 'Appuyez pour enregistrer !',
      'goal_reached': 'C\'est fait !',
      'limit_reached': 'C\'est assez ! âœ‹',
      'limit_exceeded': 'Limite dÃ©passÃ©e ! ğŸ˜±',
      'min': 'Min',
      'max': 'Max',
      'avg': 'Moy',
      'replenish_resets': 'Voir la pub',
      'resets_exhausted_msg': 'Plus de rÃ©initialisations ! Je vous redonne 3 chances aprÃ¨s une pub ? ğŸ',
      'active_action_none': 'C\'est vide ! Remplissez votre journÃ©e de belles actions ğŸ“',
      'nothing_to_reset': 'Rien Ã  effacer ! Vous n\'avez pas encore appuyÃ© ? ğŸ¤·â€â™‚ï¸',
      'delete_action_confirm': 'Voulez-vous vraiment supprimer cette action ? Tout sera effacÃ© ! ğŸ˜¢',
      'create': 'Ajouter',
      'add_action_btn': 'Ajouter',
      'delete': 'Supprimer',
      'tutorial_reset_title': 'RÃ©initialiser',
      'tutorial_reset_desc': 'Mince, mon doigt a glissÃ© ! Appuyez ici ! (Le premier du jour est gratuit ! ğŸ)',
      'tutorial_action_title': 'Liste d\'actions',
      'tutorial_action_desc': 'C\'est ici que vous gÃ©rez vos actions. PrÃªt ? âœ¨',
      'tutorial_record_title': 'Enregistrer l\'action',
      'tutorial_record_desc': 'Appuyez doucement pour enregistrer ! Glissez sur le cÃ´tÃ© pour voir d\'autres actions ! ğŸ‘†',
      'tutorial_help_title': 'Aide',
      'tutorial_help_desc': 'Pas de panique ! Je vous expliquerai Ã  nouveau Ã  tout moment. ğŸ’¡',
      'tutorial_goal_input_title': 'Fixer l\'objectif',
      'tutorial_goal_input_desc': 'Noter un objectif facilite le suivi ! Mettez 0 pour enregistrer sans objectif. ğŸ¯',
      'tutorial_goal_type_title': 'Type d\'action',
      'tutorial_goal_type_desc': 'Est-ce positif pour vous ou nÃ©gatif ? Choisissez ce qui correspond ! ğŸ‘ğŸ‘',
      'tutorial_goal_active_title': 'Activer l\'action',
      'tutorial_goal_active_desc': 'DÃ©cidez si vous voulez l\'afficher sur l\'Ã©cran principal avec l\'interrupteur ! ğŸ”˜',
      'tutorial_goal_reorder_title': 'RÃ©organiser',
      'tutorial_goal_reorder_desc': 'Maintenez enfoncÃ© pour monter ou descendre ! Rangez-les selon vos prioritÃ©s. â†•ï¸',
      'tutorial_goal_delete_title': 'Supprimer l\'action',
      'tutorial_goal_delete_desc': 'L\'adieu n\'est pas Ã©ternel... Glissez vers la gauche pour supprimer ! ğŸ—‘ï¸',
      'tutorial_goal_help_title': 'Aide',
      'tutorial_goal_help_desc': 'Si vous avez des questions, appelez-moi. Je vous attends ici ! ğŸ™‹â€â™‚ï¸',
      'custom': 'EntrÃ©e directe',
      'action_placeholder': 'Qu\'allons-nous Did it aujourd\'hui ?',
      'confirm': 'Confirmer',
      'ok': 'OK',
    },
    'de': {
      'settings': 'Einstellungen',
      'language': 'Sprache',
      'follow_system': 'Standardsystem',
      'reset': 'ZurÃ¼cksetzen',
      // Action Types
      'action_coffee': 'Kaffee',
      'action_water': 'Wasser trinken',
      'action_pill': 'Medizin',
      'action_exercise': 'Sport',
      'action_snack': 'Snacks',
      'cloud_backup': 'Backup & Wiederherstellung',
      'backup': 'Datensicherung',
      'restore': 'Wiederherstellung',
      'backup_success': 'Datensicherung abgeschlossen!',
      'restore_success': 'Wiederherstellung abgeschlossen!',
      'backup_desc': 'Sollen wir Ihre wertvollen Daten sicher in der Cloud speichern? â˜ï¸',
      'restore_desc': 'MÃ¶chten Sie die in der Cloud gespeicherten Daten wiederherstellen? (Aktuelle Daten gehen verloren!) ğŸ“¥',
      'days': 'Tage',
      'goal_label': 'Ziel',
      'reset_confirm': 'Hoppla, war das ein Fehler? Sollen wir es lÃ¶schen? ğŸ§¹',
      'cancel': 'Abbrechen',
      'no_data': 'Keine Daten aufgezeichnet',
      'tap_to_record': 'Zum Aufzeichnen tippen!',
      'goal_reached': 'Geschafft!',
      'limit_reached': 'Genau richtig! âœ‹',
      'limit_exceeded': 'Zu viel! ğŸ˜±',
      'min': 'Min',
      'max': 'Max',
      'avg': 'Durchs.',
      'replenish_resets': 'Werbung ansehen',
      'resets_exhausted_msg': 'Keine Resets mehr! Sollen wir Ihnen nach einer Anzeige 3 weitere Chancen geben? ğŸ',
      'active_action_none': 'Es ist leer! FÃ¼llen Sie Ihren Tag mit wunderbaren Aktionen ğŸ“',
      'nothing_to_reset': 'Nichts zum LÃ¶schen! Haben Sie noch nicht getippt? ğŸ¤·â€â™‚ï¸',
      'delete_action_confirm': 'MÃ¶chten Sie sich wirklich von dieser Aktion verabschieden? Alle Aufzeichnungen werden gelÃ¶scht! ğŸ˜¢',
      'create': 'HinzufÃ¼gen',
      'add_action_btn': 'HinzufÃ¼gen',
      'delete': 'LÃ¶schen',
      'tutorial_reset_title': 'ZurÃ¼cksetzen',
      'tutorial_reset_desc': 'Hoppla, mein Finger ist ausgerutscht! Tippen Sie hier! (Das erste Mal am Tag ist kostenlos! ğŸ)',
      'tutorial_action_title': 'Aktionsliste',
      'tutorial_action_desc': 'Hier verwalten Sie Ihre Aktionen. Bereit? âœ¨',
      'tutorial_record_title': 'Aktion aufzeichnen',
      'tutorial_record_desc': 'Sanft tippen zum Aufzeichnen! Seitlich wischen fÃ¼r andere Aktionen! ğŸ‘†',
      'tutorial_help_title': 'Hilfe',
      'tutorial_help_desc': 'Keine Panik! Ich erklÃ¤re es Ihnen jederzeit gerne wieder. ğŸ’¡',
      'tutorial_goal_input_title': 'Ziel setzen',
      'tutorial_goal_input_desc': 'Ein Ziel macht die Verfolgung des Fortschritts sehr einfach! Bei 0 wird ohne Ziel aufgezeichnet. ğŸ¯',
      'tutorial_goal_type_title': 'Aktionstyp',
      'tutorial_goal_type_desc': 'Ist das positiv fÃ¼r Sie oder negativ? WÃ¤hlen Sie das Passende! ğŸ‘ğŸ‘',
      'tutorial_goal_active_title': 'Aktion aktivieren',
      'tutorial_goal_active_desc': 'Entscheiden Sie mit dem Schalter, ob sie auf dem Hauptbildschirm angezeigt wird! ğŸ”˜',
      'tutorial_goal_reorder_title': 'Neu ordnen',
      'tutorial_goal_reorder_desc': 'GedrÃ¼ckt halten zum Verschieben! Ordnen Sie sie so, wie es fÃ¼r Sie wichtig ist. â†•ï¸',
      'tutorial_goal_delete_title': 'Aktion lÃ¶schen',
      'tutorial_goal_delete_desc': 'Abschied ist nicht fÃ¼r immer... Zum LÃ¶schen nach links wischen! ğŸ—‘ï¸',
      'tutorial_goal_help_title': 'Hilfe',
      'tutorial_goal_help_desc': 'Bei Fragen rufen Sie mich einfach. Ich warte hier! ğŸ™‹â€â™‚ï¸',
      'custom': 'Direkteingabe',
      'action_placeholder': 'Was wollen wir heute Did it machen?',
      'confirm': 'BestÃ¤tigen',
      'ok': 'OK',
    },
  };

  String tr(String key) {
    // Determine current language code (e.g., 'en', 'ko')
    String langCode = _locale?.languageCode ?? ui.PlatformDispatcher.instance.locale.languageCode;
    langCode = langCode.split('_')[0].split('-')[0].toLowerCase();
    
    // Ensure the language exists in our translations, fallback to 'en'
    final String currentLang = translations.containsKey(langCode) ? langCode : 'en';
    
    // Lookup the key, fallback to English version, then to the key itself
    final String text = translations[currentLang]?[key] ?? 
                       translations['en']?[key] ?? 
                      key;
                       
    // Replace underscores with spaces and sanitize multiple spaces (preserving newlines)
    return text.replaceAll('_', ' ').replaceAll(RegExp(r' +'), ' ').trim();
  }
}
